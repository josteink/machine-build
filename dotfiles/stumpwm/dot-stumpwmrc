;; Hey, Emacs! This is a -*- lisp -*- file!
(in-package :stumpwm)

;; basic stuff
(defun x-setup-once ()
  (defvar *x-setup-initialized*)
  (if (boundp '*initialized*)
      (message "Already initialized, so skipping X setup.")
      (progn
        (run-shell-command "stalonetray")
        ;;(run-shell-command "nm-applet --sm-disable")
        (run-shell-command "xscreensaver &")
	(run-shell-command "dropbox start")
        (setq *x-setup-initialized* t))))


;; because it never hurts to be able to load external modules
(load "~/quicklisp/setup.lisp")


;; custom-commands
(defcommand screen-saver () ()
  "Turns off the screen until a key is pressed"
  (run-shell-command
   "xscreensaver-command -lock"))

(defcommand firefox () ()
  "Start Firefox unless it is already running, in which case focus it."
  (run-or-raise "firefox" '(:class "Firefox")))

;; for debugging/fooling around
(ql:quickload :swank)
(defcommand swank () ()
  (swank:create-server :port 4005
                       :style swank:*communication-style*
                       :dont-close t)
  (echo-string (current-screen)
               "Starting swank. M-x slime-connect RET RET, then (in-package stumpwm)."))

;;(swank)


;;(ql:quickload :sb-unix)

;; X setup
(x-setup-once)

;; my hotkeys (thanks in part to http://stumpwm.svkt.org/cgi-bin/wiki.pl)
;;(define-key *root-map* (kbd "B") "show-battery-state")
;;(define-key *root-map* (kbd "x") "nemo")
(define-key *root-map* (kbd "DEL") "quit")
;;(define-key *root-map* (kbd "q") "suspend")
(define-key *root-map* (kbd "L") "screen-saver")
(define-key *root-map* (kbd "M-s") "spotify")
(define-key *root-map* (kbd "d") "firefox")
;;(define-key *root-map* (kbd "D") "chromium")
(define-key *root-map* (kbd "c") "exec x-terminal-emulator")
;;(define-key *top-map* (kbd "XF86AudioRaiseVolume") "raise-volume")
;;(define-key *top-map* (kbd "XF86AudioLowerVolume") "lower-volume")
;;(define-key *top-map* (kbd "XF86AudioMute") "toggle-mute-volume")
(define-key *top-map* (kbd "M-Tab") "pull-hidden-next")
(define-key *top-map* (kbd "s-Tab") "fnext")

;; startup stuff - safe to do this multiple times
;;(run-shell-command (concatenate 'string "xsetbg -border black -center " home "/Pictures/stumpwm_wallpaper.jpg"))
(run-shell-command "emacs")

;; swap CAPS and CTRL
;; (run-shell-command "setxkbmap -option ctrl:swapcaps")

(setq *window-format* "%n%s%80t [%20c]")


;; TODO: add things for
;; -- Command: gnext
;; Cycle to the next group in the group list.

;; -- Command: gprev
;; Cycle to the previous group in the group list.

;; -- Command: gnext-with-window
;; Cycle to the next group in the group list, taking the current
;; window along.

;; -- Command: gprev-with-window
;; Cycle to the previous group in the group list, taking the current
;; window along.
